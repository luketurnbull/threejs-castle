import { useAppStore } from "../../store";
import { useEffect, useRef } from "react";
import gsap from "gsap";

export function ModeToggle() {
  const mode = useAppStore((state) => state.mode);
  const setDay = useAppStore((state) => state.setDay);
  const setNight = useAppStore((state) => state.setNight);
  const sunRef = useRef<SVGSVGElement>(null);
  const moonRef = useRef<SVGSVGElement>(null);
  const containerRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    if (!sunRef.current || !moonRef.current) return;
    if (mode === "day") {
      gsap.to(sunRef.current, {
        opacity: 1,
        scale: 1,
        rotate: 0,
        duration: 0.5,
        ease: "power2.inOut",
        pointerEvents: "auto",
      });
      gsap.to(moonRef.current, {
        opacity: 0,
        scale: 0.8,
        rotate: -180,
        duration: 0.5,
        ease: "power2.inOut",
        pointerEvents: "none",
      });
    } else {
      gsap.to(sunRef.current, {
        opacity: 0,
        scale: 0.8,
        rotate: 180,
        duration: 0.5,
        ease: "power2.inOut",
        pointerEvents: "none",
      });
      gsap.to(moonRef.current, {
        opacity: 1,
        scale: 1,
        rotate: 0,
        duration: 0.5,
        ease: "power2.inOut",
        pointerEvents: "auto",
      });
    }
  }, [mode]);

  return (
    <div
      ref={containerRef}
      onClick={mode === "day" ? setNight : setDay}
      style={{
        width: "100px",
        height: "100px",
        display: "inline-block",
        cursor: "pointer",
        position: "fixed",
        overflow: "visible",
        transition: "transform 0.2s cubic-bezier(.4,2,.6,1)",
        top: "20px",
        right: "20px",
      }}
      onMouseEnter={(e) => {
        e.currentTarget.style.transform = "scale(1.15)";
      }}
      onMouseLeave={(e) => {
        e.currentTarget.style.transform = "scale(1)";
      }}
    >
      {/* Sun SVG - full original markup */}
      <svg
        ref={sunRef}
        width="100%"
        height="100%"
        viewBox="0 0 105 104"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
        style={{
          opacity: mode === "day" ? 1 : 0,
          transform:
            mode === "day"
              ? "scale(1) rotate(0deg)"
              : "scale(0.8) rotate(180deg)",
          pointerEvents: mode === "day" ? "auto" : "none",
        }}
      >
        <mask
          id="mask0_9_82"
          style={{ maskType: "luminance" }}
          maskUnits="userSpaceOnUse"
          x="0"
          y="0"
          width="105"
          height="104"
        >
          <path
            d="M105 51.9182L104.521 58.9636C102.249 73.157 95.6029 84.509 84.5814 93.0188C73.4835 101.522 60.4152 104.97 45.3764 103.363C31.0233 101.116 19.5443 94.5436 10.939 83.6441C8.18188 80.1209 5.91067 76.2821 4.12573 72.1272L1.87533 65.7204C0.638917 61.3119 0.0138758 56.7111 0 51.9182C0.375277 37.2106 5.50091 24.9731 15.3769 15.2069C25.2529 5.44016 37.6271 0.371535 52.5001 0C67.3726 0.371535 79.7471 5.44016 89.6233 15.2069C99.4995 24.9731 104.625 37.2106 105 51.9182Z"
            fill="white"
          />
        </mask>
        <g mask="url(#mask0_9_82)">
          <mask
            id="mask1_9_82"
            style={{ maskType: "luminance" }}
            maskUnits="userSpaceOnUse"
            x="0"
            y="0"
            width="105"
            height="104"
          >
            <path
              d="M105 51.9182L104.521 58.9636C102.249 73.157 95.6029 84.509 84.5814 93.0188C73.4835 101.522 60.4152 104.97 45.3764 103.363C31.0233 101.116 19.5443 94.5436 10.939 83.6441C8.18188 80.1209 5.91067 76.2821 4.12573 72.1272L1.87533 65.7204C0.638917 61.3119 0.0138758 56.7111 0 51.9182C0.375277 37.2106 5.50091 24.9731 15.3769 15.2069C25.2529 5.44016 37.6271 0.371535 52.5001 0C67.3726 0.371535 79.7471 5.44016 89.6233 15.2069C99.4995 24.9731 104.625 37.2106 105 51.9182Z"
              fill="white"
            />
          </mask>
          <g mask="url(#mask1_9_82)">
            <path d="M0 0V104.97H105V0H0Z" fill="#846C64" />
          </g>
        </g>
        <mask
          id="mask2_9_82"
          style={{ maskType: "luminance" }}
          maskUnits="userSpaceOnUse"
          x="2"
          y="2"
          width="101"
          height="100"
        >
          <path
            d="M103 52.0436L102.539 58.8346C100.354 72.5155 93.9609 83.4577 83.3592 91.6602C72.6841 99.8563 60.1137 103.18 45.6477 101.631C31.8415 99.4655 20.7997 93.1299 12.5222 82.624C9.87019 79.228 7.6855 75.5278 5.96856 71.5229L3.80389 65.3475C2.61458 61.0982 2.01335 56.6635 2 52.0436C2.36098 37.8671 7.29135 26.0714 16.7911 16.6579C26.2909 7.24374 38.1937 2.35812 52.5001 2C66.8061 2.35812 78.7091 7.24374 88.2091 16.6579C97.7091 26.0714 102.639 37.8671 103 52.0436Z"
            fill="white"
          />
        </mask>
        <g mask="url(#mask2_9_82)">
          <mask
            id="mask3_9_82"
            style={{ maskType: "luminance" }}
            maskUnits="userSpaceOnUse"
            x="2"
            y="2"
            width="101"
            height="100"
          >
            <path
              d="M103 52.0436L102.539 58.8346C100.354 72.5155 93.9609 83.4577 83.3592 91.6602C72.6841 99.8563 60.1137 103.18 45.6477 101.631C31.8415 99.4655 20.7997 93.1299 12.5222 82.624C9.87019 79.228 7.6855 75.5278 5.96856 71.5229L3.80389 65.3475C2.61458 61.0982 2.01335 56.6635 2 52.0436C2.36098 37.8671 7.29135 26.0714 16.7911 16.6579C26.2909 7.24374 38.1937 2.35812 52.5001 2C66.8061 2.35812 78.7091 7.24374 88.2091 16.6579C97.7091 26.0714 102.639 37.8671 103 52.0436Z"
              fill="white"
            />
          </mask>
          <g mask="url(#mask3_9_82)">
            <path d="M2 2V103.18H103V2H2Z" fill="url(#paint0_radial_9_82)" />
          </g>
        </g>
        <defs>
          <radialGradient
            id="paint0_radial_9_82"
            cx="0"
            cy="0"
            r="1"
            gradientUnits="userSpaceOnUse"
            gradientTransform="translate(52.4913 52.9772) scale(50.5178 50.0613)"
          >
            <stop stopColor="#FEEB3A" />
            <stop offset="1" stopColor="#FEC106" />
          </radialGradient>
        </defs>
      </svg>
      {/* Moon SVG - full original markup */}
      <svg
        ref={moonRef}
        width="101"
        height="100"
        viewBox="0 0 101 100"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
        style={{
          position: "absolute",
          left: 0,
          top: 0,
          opacity: mode === "night" ? 1 : 0,
          transform:
            mode === "night"
              ? "scale(1) rotate(0deg)"
              : "scale(0.8) rotate(-180deg)",
          pointerEvents: mode === "night" ? "auto" : "none",
        }}
      >
        <path
          d="M72.7725 66.8726C71.7972 66.1456 70.6066 65.7815 69.2008 65.7815C67.7948 65.7815 66.5901 66.1456 65.5855 66.8726C65.2128 67.164 64.9109 67.4662 64.6823 67.7817C64.5675 67.6846 64.4376 67.5999 64.2943 67.5272C63.434 66.9937 62.401 66.7272 61.196 66.7272C59.9913 66.7272 58.9583 66.9937 58.0979 67.5272C57.2366 68.0608 56.8067 68.7031 56.8067 69.4544C56.8067 70.2063 57.2366 70.8486 58.0979 71.3816C58.9583 71.9151 59.9913 72.1816 61.196 72.1816C62.401 72.1816 63.434 71.9151 64.2943 71.3816C64.4092 71.3089 64.5241 71.2359 64.6387 71.1641C64.8684 71.5273 65.184 71.8665 65.5855 72.1816C66.5901 72.9089 67.7948 73.2727 69.2008 73.2727C70.6066 73.2727 71.7972 72.9089 72.7725 72.1816C73.777 71.4543 74.2787 70.5695 74.2787 69.5271C74.2787 68.4847 73.777 67.5999 72.7725 66.8726ZM62.0139 74.3999C61.5547 74.788 61.3252 75.2609 61.3252 75.8184C61.3252 76.376 61.5547 76.8489 62.0139 77.2361C62.4728 77.624 63.0325 77.8183 63.6918 77.8183C64.3521 77.8183 64.9109 77.624 65.3701 77.2361C65.8293 76.8489 66.0588 76.376 66.0588 75.8184C66.0588 75.2609 65.8293 74.788 65.3701 74.3999C64.9109 74.012 64.3521 73.8183 63.6918 73.8183C63.0325 73.8183 62.4728 74.012 62.0139 74.3999ZM31.588 12.4727C31.7891 12.3273 31.8887 12.1336 31.8887 11.8911C31.8887 11.6487 31.7891 11.4423 31.588 11.2729C31.4154 11.1272 31.186 11.0545 30.8994 11.0545C30.6128 11.0545 30.369 11.1272 30.1679 11.2729C29.9953 11.4423 29.9098 11.6487 29.9098 11.8911C29.9098 12.1336 29.9953 12.3273 30.1679 12.4727C30.369 12.6425 30.6128 12.7272 30.8994 12.7272C31.186 12.7272 31.4154 12.6425 31.588 12.4727ZM40.7545 6.36316C40.324 5.99994 39.808 5.81848 39.2049 5.81848C38.6024 5.81848 38.0863 5.99994 37.6556 6.36316C37.2257 6.72725 37.0106 7.16405 37.0106 7.67267C37.0106 8.18158 37.2257 8.61837 37.6556 8.98159C38.0863 9.34568 38.6024 9.52714 39.2049 9.52714C39.808 9.52714 40.324 9.34568 40.7545 8.98159C41.1844 8.61837 41.3998 8.18158 41.3998 7.67267C41.3998 7.16405 41.1844 6.72725 40.7545 6.36316ZM53.9665 10.9088C53.0765 10.3999 51.9867 10.1457 50.6955 10.1457C49.4044 10.1457 48.3002 10.3999 47.3821 10.9088C46.4921 11.4423 46.0481 12.0729 46.0481 12.7999C46.0481 13.5272 46.4921 14.1455 47.3821 14.6544C48.3002 15.1879 49.4044 15.4544 50.6955 15.4544C51.4645 15.4544 52.1531 15.3576 52.7609 15.1639C53.4449 14.6837 54.133 14.2835 54.8269 13.9631C55.1712 13.6219 55.343 13.2338 55.343 12.7999C55.343 12.0729 54.884 11.4423 53.9665 10.9088ZM91.2347 57.091C91.2347 57.3815 91.3639 57.636 91.6218 57.8544C91.88 58.0728 92.1815 58.1815 92.5258 58.1815C92.8702 58.1815 93.1711 58.0728 93.429 57.8544C93.6881 57.636 93.817 57.3815 93.817 57.091C93.817 56.7999 93.6881 56.5455 93.429 56.3271C93.1711 56.1087 92.8702 55.9999 92.5258 55.9999C92.1815 55.9999 91.88 56.1087 91.6218 56.3271C91.3639 56.5455 91.2347 56.7999 91.2347 57.091ZM45.6601 90.6543C44.9146 90.6543 44.226 90.7879 43.595 91.0544C43.1074 91.2488 42.6625 91.5152 42.2602 91.8544C41.3137 92.6544 40.8401 93.6119 40.8401 94.727C40.8401 95.8425 41.3137 96.7999 42.2602 97.5999C43.207 98.3999 44.3405 98.8001 45.6601 98.8001C46.9797 98.8001 48.1135 98.3999 49.06 97.5999C50.0069 96.7999 50.4801 95.8425 50.4801 94.727C50.4801 93.6119 50.0069 92.6544 49.06 91.8544C48.7441 91.5879 48.415 91.3695 48.0707 91.1998C47.3533 90.836 46.5498 90.6543 45.6601 90.6543Z"
          fill="#DDDBD9"
        />
        <path
          d="M91.6218 57.8545C91.3639 57.6361 91.2347 57.3816 91.2347 57.0911C91.2347 56.8 91.3639 56.5455 91.6218 56.3271C91.88 56.1087 92.1815 56 92.5258 56C92.8702 56 93.1711 56.1087 93.429 56.3271C93.6881 56.5455 93.817 56.8 93.817 57.0911C93.817 57.3816 93.6881 57.6361 93.429 57.8545C93.1711 58.0729 92.8702 58.1816 92.5258 58.1816C92.1815 58.1816 91.88 58.0729 91.6218 57.8545ZM90.03 34.5087C90.1724 34.1367 90.2873 33.7726 90.3734 33.4185C90.4792 33.8582 90.5797 34.2941 90.6753 34.7271C90.4763 34.614 90.2609 34.5413 90.03 34.5087ZM75.5699 23.673C74.2503 20.3999 72.0838 19.721 69.0716 21.6367C67.6374 22.921 66.4318 22.921 65.4566 21.6367C62.8742 19.6002 62.4444 17.1761 64.1654 14.3639C60.7371 12.9149 57.6243 12.7821 54.8269 13.9632C54.133 14.2836 53.4449 14.6838 52.7609 15.1639C52.3451 15.4808 51.9296 15.832 51.5131 16.2184C50.9678 18.0122 49.4615 18.5698 46.9949 17.8911C50.2079 23.9512 50.9394 28.0729 49.1893 30.2545C44.8569 32.2913 42.9204 34.497 43.3796 36.8727C43.4945 38.3273 42.4044 39.5641 40.1087 40.5817C32.9938 23.4185 24.6877 20.4849 15.1915 31.7815C5.86737 52.921 14.8331 66.073 42.0885 71.236C44.2116 70.3152 45.976 67.8424 47.3821 63.8183C49.8779 64.0361 51.3265 62.4968 51.7285 59.2C50.6955 54.9575 49.247 51.7458 47.3821 49.5641C45.2302 47.5513 45.7038 45.9153 48.8022 44.6544C50.0069 43.9034 50.0069 42.4848 48.8022 40.3999C48.6873 38.3634 50.079 37.0184 52.976 36.3632C55.5868 37.0184 57.9974 35.6001 60.2066 32.109C60.4645 34.9696 63.1758 37.5153 68.3401 39.7456C69.3441 38.8729 70.1333 39.3217 70.7071 41.0912V43.8183L75.0102 48.7272C78.7688 49.4545 80.5189 48.6545 80.261 46.3271C77.9652 44.9936 75.6848 42.5695 73.4183 39.0543C71.4385 35.0305 72.3417 33.4546 76.1296 34.3273L84.7795 42.109C87.1523 43.9819 89.3606 43.8726 91.4067 41.7815C91.4337 44.2786 91.2467 46.8967 90.847 49.6359C89.0682 61.6121 84.3203 71.3336 76.6029 78.8001C68.8849 86.2424 59.8471 90.3512 49.4908 91.1272C49.0032 91.1512 48.5296 91.1761 48.0707 91.1999C48.4151 91.3696 48.7441 91.588 49.06 91.8545C50.0069 92.6545 50.4801 93.6119 50.4801 94.7271C50.4801 95.8425 50.0069 96.8 49.06 97.6C48.1135 98.4 46.9797 98.8001 45.6601 98.8001C44.3405 98.8001 43.207 98.4 42.2602 97.6C41.3137 96.8 40.8401 95.8425 40.8401 94.7271C40.8401 93.6119 41.3137 92.6545 42.2602 91.8545C42.6626 91.5153 43.1074 91.2488 43.595 91.0545C35.3891 90.2545 27.5572 86.5575 20.0971 79.964C10.8307 71.7695 4.99204 56.3512 2.58232 33.709C0.860677 38.7761 0 44.2065 0 50C0 63.8183 4.90647 75.6001 14.7182 85.3456C24.5587 95.1152 36.4365 100 50.3512 100C64.2659 100 76.1296 95.1152 85.9414 85.3456C95.7816 75.6001 100.702 63.8183 100.702 50C100.702 36.1817 95.7816 24.388 85.9414 14.6184C79.371 8.07289 71.869 3.73366 63.434 1.6001C70.3194 6.9337 77.0471 13.2728 83.6172 20.6183C85.9698 23.2482 87.7914 26.1697 89.0826 29.3818C87.5317 28.2388 85.9827 28.1898 84.4348 29.2361C83.6893 28.7761 83.0434 28.6545 82.4987 28.8729L75.5699 23.673Z"
          fill="#DADEDD"
        />
        <path
          d="M39.2049 5.81848C39.808 5.81848 40.3241 5.99994 40.7545 6.36315C41.1844 6.72725 41.3998 7.16404 41.3998 7.67266C41.3998 8.18157 41.1844 8.61837 40.7545 8.98158C40.3241 9.34568 39.808 9.52714 39.2049 9.52714C38.6024 9.52714 38.0863 9.34568 37.6556 8.98158C37.2257 8.61837 37.0106 8.18157 37.0106 7.67266C37.0106 7.16404 37.2257 6.72725 37.6556 6.36315C38.0863 5.99994 38.6024 5.81848 39.2049 5.81848ZM31.8887 11.8911C31.8887 12.1336 31.7891 12.3273 31.588 12.4727C31.4154 12.6425 31.186 12.7272 30.8994 12.7272C30.6128 12.7272 30.369 12.6425 30.1679 12.4727C29.9953 12.3273 29.9098 12.1336 29.9098 11.8911C29.9098 11.6487 29.9953 11.4423 30.1679 11.2729C30.369 11.1272 30.6128 11.0545 30.8994 11.0545C31.186 11.0545 31.4154 11.1272 31.588 11.2729C31.7891 11.4423 31.8887 11.6487 31.8887 11.8911ZM61.3252 75.8184C61.3252 75.2609 61.5547 74.788 62.0139 74.3999C62.4728 74.012 63.0325 73.8183 63.6919 73.8183C64.3521 73.8183 64.9109 74.012 65.3701 74.3999C65.8293 74.788 66.0588 75.2609 66.0588 75.8184C66.0588 76.376 65.8293 76.8489 65.3701 77.2361C64.9109 77.624 64.3521 77.8183 63.6919 77.8183C63.0325 77.8183 62.4728 77.624 62.0139 77.2361C61.5547 76.8489 61.3252 76.376 61.3252 75.8184ZM69.2008 65.7815C70.6066 65.7815 71.7972 66.1456 72.7725 66.8726C73.777 67.5999 74.2787 68.4847 74.2787 69.5271C74.2787 70.5695 73.777 71.4543 72.7725 72.1816C71.7972 72.9089 70.6066 73.2727 69.2008 73.2727C67.7948 73.2727 66.5901 72.9089 65.5855 72.1816C65.184 71.8665 64.8684 71.5273 64.6387 71.1641C64.5241 71.2359 64.4092 71.3089 64.2944 71.3816C63.434 71.9151 62.401 72.1816 61.196 72.1816C59.9913 72.1816 58.9583 71.9151 58.0979 71.3816C57.2366 70.8486 56.8067 70.2063 56.8067 69.4544C56.8067 68.7031 57.2366 68.0608 58.0979 67.5272C58.9583 66.9937 59.9913 66.7272 61.196 66.7272C62.401 66.7272 63.434 66.9937 64.2944 67.5272C64.4377 67.5999 64.5675 67.6846 64.6824 67.7817C64.9109 67.4662 65.2128 67.164 65.5855 66.8726C66.5901 66.1456 67.7948 65.7815 69.2008 65.7815ZM50.6955 10.1457C51.9867 10.1457 53.0765 10.3999 53.9665 10.9088C54.8841 11.4423 55.343 12.0729 55.343 12.7999C55.343 13.2338 55.1712 13.6219 54.8269 13.9631C57.6243 12.782 60.7371 12.9148 64.1654 14.3639C62.4444 17.1761 62.8743 19.6001 65.4566 21.6367C66.4318 22.921 67.6374 22.921 69.0716 21.6367C72.0838 19.7209 74.2503 20.3998 75.5699 23.6729L82.4987 28.8728C83.0435 28.6544 83.6893 28.7761 84.4348 29.236C85.9827 28.1898 87.5318 28.2387 89.0826 29.3817C87.7914 26.1697 85.9698 23.2481 83.6172 20.6182C77.0471 13.2727 70.3194 6.93363 63.434 1.60002C62.3145 1.30892 61.196 1.06649 60.0768 0.872713C56.95 0.2911 53.7084 0 50.3512 0C36.4365 0 24.5587 4.87277 14.7182 14.6183C9.00853 20.2911 4.96332 26.6545 2.58232 33.7089C4.99204 56.3511 10.8307 71.7694 20.0971 79.9639C27.5572 86.5575 35.3891 90.2544 43.595 91.0544C44.226 90.7879 44.9146 90.6543 45.6601 90.6543C46.5498 90.6543 47.3534 90.836 48.0707 91.1998C48.5296 91.1761 49.0032 91.1512 49.4908 91.1271C59.8471 90.3511 68.8849 86.2423 76.6029 78.8001C84.3203 71.3335 89.0682 61.612 90.847 49.6359C91.2467 46.8967 91.4337 44.2785 91.4067 41.7815C89.3607 43.8725 87.1523 43.9819 84.7795 42.1089L76.1296 34.3272C72.3417 33.4545 71.4385 35.0305 73.4184 39.0543C75.6848 42.5695 77.9653 44.9935 80.261 46.3271C80.5189 48.6544 78.7688 49.4544 75.0102 48.7271L70.7071 43.8183V41.0911C70.1333 39.3216 69.3441 38.8728 68.3402 39.7455C63.1758 37.5152 60.4645 34.9695 60.2067 32.1089C57.9974 35.6001 55.5868 37.0183 52.976 36.3631C50.079 37.0183 48.6873 38.3633 48.8022 40.3998C50.0069 42.4847 50.0069 43.9033 48.8022 44.6543C45.7038 45.9152 45.2302 47.5513 47.3821 49.5641C49.247 51.7457 50.6955 54.9575 51.7285 59.2C51.3265 62.4967 49.8779 64.0361 47.3821 63.8183C45.976 67.8424 44.2116 70.3151 42.0885 71.2359C14.8331 66.0729 5.86737 52.9209 15.1915 31.7815C24.6877 20.4849 32.9938 23.4184 40.1087 40.5816C42.4044 39.5641 43.4945 38.3273 43.3796 36.8726C42.9204 34.4969 44.8569 32.2913 49.1893 30.2544C50.9394 28.0728 50.2079 23.9511 46.995 17.8911C49.4615 18.5697 50.9678 18.0121 51.5131 16.2183C51.9296 15.832 52.3451 15.4808 52.7609 15.1639C52.1532 15.3576 51.4645 15.4544 50.6955 15.4544C49.4044 15.4544 48.3002 15.1879 47.3821 14.6544C46.4921 14.1455 46.0481 13.5272 46.0481 12.7999C46.0481 12.0729 46.4921 11.4423 47.3821 10.9088C48.3002 10.3999 49.4044 10.1457 50.6955 10.1457ZM90.3734 33.4184C90.2873 33.7726 90.1724 34.1366 90.03 34.5087C90.2609 34.5412 90.4763 34.6139 90.6753 34.7271C90.5797 34.2941 90.4792 33.8582 90.3734 33.4184Z"
          fill="#F7F7F7"
        />
        <path
          d="M34.6697 23.9342C33.8618 23.9506 33.8492 23.9641 33.8325 24.8089C33.8169 23.9641 33.804 23.9506 32.9952 23.9342C33.804 23.9175 33.8169 23.904 33.8325 23.0597C33.8492 23.904 33.8618 23.9175 34.6697 23.9342Z"
          fill="white"
        />
      </svg>
    </div>
  );
}
